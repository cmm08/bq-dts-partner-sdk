# https://cloud.google.com/bigquery/docs/reference/data-transfer/partner/rpc/google.cloud.bigquery.datatransfer.v1#datasourcedefinition

# For each TransferRun,  "run_time" = "schedule_time" + "run_time_offset"
run_time_offset:
  seconds: -86400
support_email: bq-dts-support+calendar@google.com

# https://cloud.google.com/bigquery/docs/reference/data-transfer/partner/rest/v1/projects.locations/list
supported_location_ids:
- us
- europe
- asia-northeast1

# https://cloud.google.com/bigquery/docs/reference/data-transfer/partner/rpc/google.cloud.bigquery.datatransfer.v1#datasource
data_source:
  display_name: Calendar
  description: Calendar Data Source
  help_url: https://en.wikipedia.org/wiki/Gregorian_calendar

  # Automatically mark a TransferRun as FAILED if "update_deadline_seconds" elapses without an "update"... "update" can be triggered below
  # NOTE - This is effectively 2 deadlines in 1
  ### Deadline 1 - Amount of time a Pub/Sub Message can sit in a Subscription without any worker processing it
  ### Deadline 2 - Once a worker begins work on a TransferRun, the time within which BQ DTS needs to be updated

  # An "update" is defined as either...
  # * UpdateTransferRun - https://cloud.google.com/bigquery/docs/reference/data-transfer/partner/rpc/google.cloud.bigquery.datatransfer.v1#updatetransferrunrequest
  # * LogTransferRunMessages - https://cloud.google.com/bigquery/docs/reference/data-transfer/partner/rpc/google.cloud.bigquery.datatransfer.v1#logtransferrunmessagesrequest
  # EXAMPLE - Allow 4 hours for our Data Source to respond
  update_deadline_seconds: 14400

  ### Scheduling
  default_schedule: every 24 hours
  supports_custom_schedule: true
  minimum_schedule_interval:
    seconds: 86400
  manual_runs_disabled: false

  # https://cloud.google.com/bigquery/docs/reference/data-transfer/partner/rpc/google.cloud.bigquery.datatransfer.v1#authorizationtype
  authorization_type: AUTHORIZATION_CODE

  # https://cloud.google.com/bigquery/docs/reference/data-transfer/partner/rpc/google.cloud.bigquery.datatransfer.v1#datarefreshtype
  data_refresh_type: DATA_REFRESH_TYPE_UNSPECIFIED

  # https://cloud.google.com/bigquery/docs/reference/data-transfer/partner/rpc/google.cloud.bigquery.datatransfer.v1#datasourceparameter
  parameters:
  - param_id: min_date
    display_name: Minimum Date
    description: Minimum Date for the 'date_greg' table.
    type: STRING
    required: true
    validation_regex: \d{4}-\d{2}-\d{2}
    validation_description: Invalid date, please specify in 'YYYY-MM-DD' format.
    validation_help_url: https://en.wikipedia.org/wiki/Date_format_by_country
  - param_id: max_date
    display_name: Maximum Date
    description: Maximum Date for the 'date_greg' table in 'YYYY-MM-DD' format.
    type: STRING
    required: true
    validation_regex: \d{4}-\d{2}-\d{2}
    validation_description: Invalid date, please specify in 'YYYY-MM-DD' format.
    validation_help_url: https://en.wikipedia.org/wiki/Date_format_by_country
  - param_id: min_num
    display_name: Minimum number
    description: Minimum number for the 'num_XXX' table.
    # Integer parameter (64-bits). Will be serialized to json as string.
    type: INTEGER
    required: true
    min_value: 0
    max_value: 999999
    validation_help_url: https://en.wikipedia.org/wiki/Integer
  - param_id: max_num
    display_name: Maximum number
    description: Maximum number for the 'num_XXX' table.
    # Integer parameter (64-bits). Will be serialized to json as string.
    type: INTEGER
    required: true
    min_value: 0
    max_value: 999999
    validation_help_url: https://en.wikipedia.org/wiki/Integer
